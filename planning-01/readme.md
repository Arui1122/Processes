## 如何提高 qps 或是降低響應速度?

### 1. 提高 QPS 的策略

-   資料庫讀寫分離（讀操作分配到從庫）\
    因為大多數社交媒體的讀取操作遠遠多於寫入操作。通過將讀操作分配到多個從庫，能降低主庫的負擔，提升整體的並行讀取能力。
-   用戶分類及 Redis 快取策略（活躍 vs 非活躍用戶）\
    根據用戶的活躍度對快取策略進行分配，為最需要快速響應的用戶提供更多的資源，例如緩存更多貼文，提升整體 QPS 表現。
-   Redis 緩存熱門文章和用戶資料 \
    將熱門文章及使用者資料（如個人資訊）快取到 Redis 中，減少對資料庫的頻繁讀取，能減少後端壓力，提升服務對於熱門資料查詢的並發能力。
-   非同步處理與消息隊列 \
    使用消息隊列將非必要的計算工作（如貼文的點讚數、通知等）進行異步處理，避免在同步流程中執行耗時的計算操作，減少後端阻塞，提升系統的並行查詢處理能力。
-   動態擴展服務器節點（Kubernetes）\
    利用 Kubernetes 進行水平擴展，在高流量時動態增加伺服器節點以應對請求量，確保高併發下的 QPS 穩定增長。

### 2. 降低響應時間的策略

-   主頁貼文分批返回（分頁，Pagination）\
    分批返回貼文而不是一次性返回所有貼文，減少一次請求的響應時間和傳輸數據量，改善使用者體驗。
-   使用 CDN 緩存靜態資源 \
    CDN 可以降低圖片、CSS、JavaScript 等靜態資源的加載時間，減少伺服器的負載並優化整體的使用者體驗。
-   Redis 緩存熱門文章和用戶資料 \
    對於頻繁查詢的數據來說，如熱門貼文和用戶個人資料，直接從 Redis 中獲取可以降低資料獲取的延遲。
-   只快取文章索引，而非文章內容 \
    對於文章內容較多的情況，只快取文章索引，從 Redis 中快速讀取索引後，再通過索引去查找具體的資料庫資料。
-   連接池 \
    使用資料庫連接池來有效管理連接，避免頻繁創建和關閉連接的開銷。

## 哪些資訊可以運用 cache ?

1. 緩存首頁 feed 和個人 feed，當追蹤的用戶發布新貼文時，直接更新緩存。
2. 用戶好友列表和關係數據快取，以減少大量讀取關聯表的開銷。
3. 將需要推送的通知或消息緩存在 Redis 中，這樣當用戶上線時，能迅速獲取待處理的通知。
4. 將用戶最近的行為資料（如最近瀏覽、點讚的貼文）暫時快取在 Redis 中，用於推薦算法和個性化推送。

## 如何設計推薦演算法？有什麼相關參數？

我們預計採用混合模型，結合基於內容的推薦 (Content-Based Filtering) 和協同過濾 (Collaborative Filtering) 來設計推薦演算法，並參考 Twitter 和 Instagram 的模型設計來優化推薦邏輯，提供個性化和多樣性的內容推薦。

### 1. 基於內容的推薦

-   推薦邏輯：根據用戶過去喜歡的貼文內容（例如標籤、主題）來推薦相似內容。使用 TF-IDF 或 Word Embeddings（如 Word2Vec）計算內容相似度。

-   關鍵參數：

    -   貼文標籤和關鍵詞的相似度。
    -   貼文的類型（例如圖片、影片、文字）。
    -   與用戶過去喜好相關的其他特徵（例如地點、時間）。

-   參考： Instagram 使用圖片和文本特徵來推薦相似內容， Twitter 也使用相同文本特徵提供用戶感興趣主題相關的推文推薦。

### 2. 協同過濾

-   推薦邏輯：根據其他與當前用戶行為相似的用戶來推薦他們喜歡的內容。這種方式適合有大量用戶行為資料時，可以從中挖掘相似的行為模式。

-   關鍵參數：

    -   用戶之間的相似度（例如共同關注的帳號）。
    -   貼文之間的互動資料相似度（例如 A 和 B 用戶都按過愛心的貼文）。
    -   用戶的歷史行為（例如評論、分享）。

-   參考： Twitter 的 SimClusters 模型會基於用戶之間的社交行為和共同喜好來推薦內容， Instagram 也根據用戶的互動資料來優化 feed 排序和推薦。

### 3. 混合模型

-   推薦邏輯：由於不同用戶的資料量和行為習慣不同，我們可以將基於內容和協同過濾的推薦系統進行混合，這樣能夠根據具體情況靈活選擇最佳的推薦方式。

-   推薦策略：

    -   當用戶的行為資料不足時，使用基於內容的推薦。
    -   當用戶資料充足時，使用協同過濾來提高推薦準確性。
    -   引入隨機推薦或多樣性推薦來打破回聲室效應（Echo Chamber Effect）。

-   關鍵參數：

    -   行為權重：設置不同用戶行為的權重，例如按愛心、評論等更能反映用戶的興趣，應該設定更高的權重。
    -   時效性：考慮貼文的發佈時間，確保用戶看到最新的相關內容。
    -   熱門度和多樣性：推薦系統應該考慮熱門內容，同時保證內容的多樣性，避免回聲室效應。

-   參考： Twitter 的推薦系統結合基於內容的模型和協同過濾來推薦推文， Instagram 則是使用基於內容推薦為新用戶提供內容，並結合協同過濾來進行個性化推薦。
